{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["nonNullable","getTracer","AppRenderSpan","decodeText","encodeText","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","streamToBufferedResult","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","end","on","off","pipe","join","cloneTransformStream","source","sourceReader","readable","getReader","clone","TransformStream","start","controller","done","value","read","enqueue","transform","readableStreamTee","transformStream","transformStream2","writer","getWriter","writer2","reader","Promise","all","close","chainStreams","streams","promise","resolve","i","length","then","pipeTo","preventClose","streamFromArray","strings","ReadableStream","str","streamToString","stream","bufferedString","createBufferedTransformStream","bufferedBytes","Uint8Array","pendingFlush","flushBuffer","newBufferedBytes","byteLength","set","flush","createInsertedHTMLStream","getServerInsertedHTML","insertedHTMLChunk","renderToInitialStream","ReactDOMServer","element","streamOptions","trace","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","createInlineDataStream","dataStream","dataStreamFinished","dataStreamReader","err","error","createMoveSuffixStream","foundSuffix","endsWith","contentWithoutSuffix","createRootLayoutValidatorStream","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","JSON","stringify","tree","continueFromInitialStream","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","reduce","pipeThrough"],"mappings":"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"}