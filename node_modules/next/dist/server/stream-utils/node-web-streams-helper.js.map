{"version":3,"sources":["../../../src/server/stream-utils/node-web-streams-helper.ts"],"names":["streamToBufferedResult","cloneTransformStream","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createInlineDataStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","renderResult","renderChunks","textDecoder","TextDecoder","writable","write","chunk","push","decodeText","end","on","off","pipe","join","source","sourceReader","readable","getReader","clone","TransformStream","start","controller","done","value","read","enqueue","transform","transformStream","transformStream2","writer","getWriter","writer2","reader","Promise","all","close","streams","promise","resolve","i","length","then","pipeTo","preventClose","strings","ReadableStream","str","encodeText","stream","bufferedString","bufferedBytes","Uint8Array","pendingFlush","flushBuffer","newBufferedBytes","byteLength","set","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","createMoveSuffixStream","foundSuffix","endsWith","contentWithoutSuffix","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","reduce","pipeThrough"],"mappings":"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"}